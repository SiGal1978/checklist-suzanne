<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Checklist Suzanne</title>

<!-- PWA plein écran iPad -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable"  content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Checklist Suzanne">
<link rel="manifest" href="manifest.json">

<style>
:root{--grey:#e6e6e6;--border:2px solid #000}

body{
  margin:0;
  font-family:Arial, sans-serif;
  display:flex;                /* disposition horizontale fixe */
  height:100vh;
}

/* ---- Calendrier (2/3) ---- */
.left{
  flex:2;
  display:flex;
  flex-direction:column;
}

header{
  background:var(--grey);
  font-weight:bold;
  font-size:24px;
  text-align:center;
  padding:6px 0;
  border-bottom:var(--border);
}

.grid{
  flex:1;
  display:grid;
  grid-template-columns:repeat(5,1fr);   /* 5 colonnes fixes */
  grid-template-rows:repeat(4,auto);     /* 4 rangées, hauteur auto */
  gap:6px;
  padding:6px;
  overflow-y:auto;                       /* défile si trop de contenu */
}

section{
  border:var(--border);
  padding:4px;
  display:flex;
  flex-direction:column;
}

section h2{
  margin:0 0 4px;
  font-weight:bold;
  font-size:14px;
}

label{
  display:flex;
  align-items:center;
  font-size:12px;
  margin-bottom:2px;
}

input{
  margin-right:4px;
  transform:scale(.9);
}

/* ---- Placement exact ---- */
.lever      {grid-area:1/1}
.dejeuner   {grid-area:1/2/2/4}
.lecture    {grid-area:1/4}
.exercices  {grid-area:1/5}

.diner      {grid-area:2/1/3/6}

.medisie    {grid-area:3/1}
.jeux       {grid-area:3/2}
.ecriture   {grid-area:3/3}
.souper     {grid-area:3/4/4/6}

.tenirpropre{grid-area:4/1}
.douche     {grid-area:4/2}
.dessert    {grid-area:4/3}
.coucher    {grid-area:4/4}
.tvdemain   {grid-area:4/5}

/* Dîner : 2 colonnes invisibles pour mieux répartir le texte */
.diner label{flex:0 0 50%; box-sizing:border-box}

/* ---- Zone image (1/3) ---- */
.right{
  flex:1;
  border-left:var(--border);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  padding:8px;
}

.right img{
  max-width:100%;
  max-height:45%;
  margin-bottom:8px;
}

.quote{
  font-style:italic;
  font-size:14px;
  text-align:center;
}
</style>

<!-- Données du jour (générées) -->
<script src="today.js"></script>
</head>

<body>
<!-- Calendrier -->
<div class="left">
  <header id="title">Chargement…</header>
  <div class="grid" id="grid"></div>
</div>

<!-- Image + texte -->
<div class="right" id="image"></div>

<script>
/* Rubriques fixes dans l'ordre voulu */
const SECTIONS=[
  "Lever","Déjeuner","Lecture","Exercices",
  "Dîner",
  "Médi-sieste","Jeux stimulants","Écriture","Souper",
  "Tenir propre","Douche","Dessert","Coucher","TV demain"
];

/* Données injectées par today.js */
const data = window.CHECKLIST_DATA;
if(!data){
  document.body.innerHTML="<h2 style='padding:20px;font-family:Arial'>today.js manquant ou invalide !</h2>";
  throw new Error("today.js not found");
}

/* Construction des sections */
const grid = document.getElementById("grid");
SECTIONS.forEach((t,i)=>{
  const s=document.createElement("section");
  s.id="sec"+i;
  s.className=t.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/ /g,'');
  s.innerHTML=`<h2>■ ${t}</h2>`;
  grid.appendChild(s);
});

/* Bandeau jour/date */
document.getElementById("title").textContent=data.date_fr||data.date||"";

/* Image + texte (ajout seulement si présent) */
let html=`<img src="${data.image||'imagedujour.png'}" alt="">`;
if(data.phrase)   html += `<p class="quote">${data.phrase}</p>`;
if(data.citation) html += `<p class="quote">${data.citation}</p>`;
document.getElementById("image").innerHTML = html;

/* Remplissage des cases */
SECTIONS.forEach((t,i)=>{
  const items=data[t]||[];
  const section=document.getElementById("sec"+i);

  /* case globale à cocher */
  section.insertAdjacentHTML("beforeend",`<label><input type="checkbox">${t}</label>`);

  /* sous-éléments */
  items.forEach(txt=>{
    const l=document.createElement("label");
    l.innerHTML=`<input type="checkbox">${txt}`;
    section.appendChild(l);
  });
});

/* Persistance des coches */
document.querySelectorAll('input[type=checkbox]').forEach(cb=>{
  const k=cb.nextSibling.textContent.trim();
  cb.checked = localStorage.getItem(k)==='1';
  cb.onchange = ()=>localStorage.setItem(k,cb.checked?'1':'');
});

/* Rechargement auto à 06 h 00 */
(function(){
  const now=new Date(), next=new Date();
  next.setHours(6,0,0,0);
  if(now>=next) next.setDate(next.getDate()+1);
  setTimeout(()=>location.reload(), next-now);
})();
</script>
</body>
</html>
