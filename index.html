<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Checklist Suzanne</title>

<!-- PWA plein écran iPad -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable"      content="yes">
<link rel="manifest" href="manifest.json">

<style>
:root{--grey:#e6e6e6;--border:2px solid #000}

/* ---- Mise en page de base (paysage) ---- */
body{margin:0;font-family:Arial,sans-serif;display:flex;height:100vh}

.left {flex:2;display:flex;flex-direction:column;overflow:hidden}
.right{flex:1;border-left:var(--border);display:flex;flex-direction:column;
       justify-content:center;align-items:center;padding:8px;overflow:hidden}

header{background:var(--grey);font-weight:bold;font-size:24px;text-align:center;
       padding:6px 0;border-bottom:var(--border)}

.grid{
  flex:1;
  display:grid;
  grid-template-columns:repeat(5,1fr);
  grid-template-rows:repeat(4,auto);
  gap:6px;
  padding:6px;
  overflow-y:auto;
}

section{border:var(--border);padding:4px;display:flex;flex-direction:column}
section h2{margin:0 0 4px;font-size:14px;font-weight:bold}
label{display:inline-flex;align-items:center;font-size:12px;margin-bottom:2px}
input{margin-right:4px;transform:scale(.9)}

/* placement fixe */
.lever{grid-area:1/1} .dejeuner{grid-area:1/2/2/4} .lecture{grid-area:1/4}
.exercices{grid-area:1/5} .diner{grid-area:2/1/3/6}
.medisie{grid-area:3/1} .jeux{grid-area:3/2} .ecriture{grid-area:3/3}
.souper{grid-area:3/4/4/6}
.tenirpropre{grid-area:4/1} .douche{grid-area:4/2}
.dessert{grid-area:4/3} .coucher{grid-area:4/4} .tvdemain{grid-area:4/5}

/* Dîner : 2 col. internes sur tablette, 3 col. sur grand écran */
.diner  label{width:50%;box-sizing:border-box}
@media (min-width:1400px){ .diner label{width:33.333%} }

/* panneau image + citations */
.right img{max-width:100%;max-height:45%;margin-bottom:8px}
.quote{font-style:italic;font-size:14px;text-align:center}

/* ---- Mode PORTRAIT : pile calendrier au-dessus de l’image ---- */
@media (orientation:portrait){
  body   {flex-direction:column}
  .left  {flex:none;max-height:66vh}
  .right {flex:none;border-left:none;border-top:var(--border)}
  .grid  {grid-template-columns:repeat(2,1fr);grid-auto-rows:auto}
  /* Dîner toujours 2 colonnes internes */
  .diner label{width:50%}
}
</style>

<!-- today.js doit définir window.CHECKLIST_DATA -->
<script src="today.js"></script>
</head>

<body>
<div class="left">
  <header id="title">Chargement…</header>
  <div   class="grid" id="grid"></div>
</div>

<div class="right" id="image"></div>

<script>
/* Rubriques fixes */
const SECTIONS=[
  "Lever","Déjeuner","Lecture","Exercices",
  "Dîner",
  "Médi-sieste","Jeux stimulants","Écriture","Souper",
  "Tenir propre","Douche","Dessert","Coucher","TV demain"
];

const data = window.CHECKLIST_DATA || {};

/* ---------- Bandeau date ---------- */
document.getElementById('title').textContent = data.date_fr || data.date || '';

/* ---------- Construction grille ---------- */
const grid = document.getElementById('grid');
SECTIONS.forEach((t,i)=>{
  const s = document.createElement('section');
  s.className = t.toLowerCase()
                 .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
                 .replace(/ /g,'');
  s.innerHTML = `<h2>■ ${t}</h2>
                 <label><input type="checkbox">${t}</label>`;
  (data[t]||[]).forEach(str=>{
      s.insertAdjacentHTML('beforeend',
        `<label><input type="checkbox">${str}</label>`);
  });
  grid.appendChild(s);
});

/* ---------- Persistance coches ---------- */
document.querySelectorAll('input[type=checkbox]').forEach(cb=>{
  const key = cb.nextSibling.textContent.trim();
  cb.checked = localStorage.getItem(key)==='1';
  cb.onchange = () => localStorage.setItem(key, cb.checked?'1':'');
});

/* ---------- Section image / citations ---------- */
const zone = document.getElementById('image');
zone.innerHTML = '';                              // on vide toujours d’abord
if (data.image) zone.innerHTML =
      `<img src="${data.image}" alt="">`;         // insère l’image

/* n’ajoute phrase/citation QUE si elles existent
   ET si elles ne sont pas déjà visuellement incluses dans l’image */
if (data.phrase && !data.no_text) {
  zone.insertAdjacentHTML('beforeend', `<p class="quote">${data.phrase}</p>`);
}
if (data.citation && !data.no_text) {
  zone.insertAdjacentHTML('beforeend', `<p class="quote">${data.citation}</p>`);
}

/* ---------- Reload automatique à 06:00 ---------- */
(function(){
  const now = new Date(), next = new Date();
  next.setHours(6,0,0,0);
  if (now >= next) next.setDate(next.getDate()+1);
  setTimeout(()=>location.reload(), next-now);
})();
</script>
</body>
</html>
